<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Farshad Tabasinejad">
<meta name="dcterms.date" content="2023-02-23">

<title>Entropy - Downloading Alberta Oilsands Production Data using Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon/entropy_ai.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/favicon/entropy_ai.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Entropy</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/FarshadTabasi"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://mastodon.social/@farshadtabasinejad@fosstodon.org"><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#disclaimer" id="toc-disclaimer" class="nav-link active" data-scroll-target="#disclaimer">Disclaimer</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#downloading-the-data" id="toc-downloading-the-data" class="nav-link" data-scroll-target="#downloading-the-data">Downloading the Data</a></li>
  <li><a href="#listing-all-the-saved-xls-files-in-the-current-directory" id="toc-listing-all-the-saved-xls-files-in-the-current-directory" class="nav-link" data-scroll-target="#listing-all-the-saved-xls-files-in-the-current-directory">Listing all the saved xls files in the current directory:</a></li>
  <li><a href="#reading-the-data" id="toc-reading-the-data" class="nav-link" data-scroll-target="#reading-the-data">Reading the Data</a></li>
  <li><a href="#operators" id="toc-operators" class="nav-link" data-scroll-target="#operators">Operators</a></li>
  <li><a href="#applying-all-the-changes-to-the-data-frame-with-chain-operations" id="toc-applying-all-the-changes-to-the-data-frame-with-chain-operations" class="nav-link" data-scroll-target="#applying-all-the-changes-to-the-data-frame-with-chain-operations">Applying all the changes to the data frame with chain operations:</a></li>
  <li><a href="#merging-rows-with-the-same-operator" id="toc-merging-rows-with-the-same-operator" class="nav-link" data-scroll-target="#merging-rows-with-the-same-operator">Merging rows with the same operator</a></li>
  <li><a href="#choosing-the-top-5-producers-in-2010" id="toc-choosing-the-top-5-producers-in-2010" class="nav-link" data-scroll-target="#choosing-the-top-5-producers-in-2010">Choosing the top 5 producers in 2010</a></li>
  <li><a href="#plotting-monthly-bitumen-production-for-the-5-largest-producers" id="toc-plotting-monthly-bitumen-production-for-the-5-largest-producers" class="nav-link" data-scroll-target="#plotting-monthly-bitumen-production-for-the-5-largest-producers">Plotting monthly bitumen production for the 5 largest producers</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Downloading Alberta Oilsands Production Data using Python</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">python</div>
    <div class="quarto-category">web scraping</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Farshad Tabasinejad </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 23, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 23, 2021</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="disclaimer" class="level1">
<h1>Disclaimer</h1>
<p>This blog post is for educational purposes only. Any commercial use of the information provided in this blog post is prohibited. For more information about the AER copyright and permission to reproduce, please visit <a href="https://www.aer.ca/copyright-disclaimer">AER Copyright and Disclaimer</a>. The author is not responsible for any damage or loss caused by the use of the information provided in this blog post.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Alberta Energy Regulator (AER) lists the monthly injection and production data for all in-situ oilsands projects in Alberta on its website <a href="https://www.aer.ca/">Alberta Energy Regulator</a>. The data is available in several spreadsheets and can be downloaded from <a href="https://www.aer.ca/providing-information/data-and-reports/statistical-reports/st53">ST53: Alberta In Situ Oil Sands Production Summary</a>. The annual data are reported in separate files in <strong><code>.xls</code></strong> format. Each file has 6 different sheets with information about bitumen, water, steam, wells, SOR, and WSR.</p>
<p>In the following, It is shown how to download the data using Python. The entire source code can be downloaded by clicking on <strong><code>&lt;/&gt;Code</code></strong> next to the blog title.</p>
<section id="downloading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="downloading-the-data">Downloading the Data</h2>
<p><code>requests</code> and <code>BeautifulSoup</code> are used to download the xls files. The following code downloads all the xls files from the AER website and saves them in the current directory:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get the html</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://www.aer.ca/providing-information/data-and-reports/statistical-reports/st53'</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(url)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> r.text</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># parse the html</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(data, <span class="st">'html.parser'</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># find all the links</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>links <span class="op">=</span> soup.findAll(<span class="st">'a'</span>, href <span class="op">=</span> <span class="va">True</span>) </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># filter links for xls files</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>xls_links <span class="op">=</span> [link <span class="cf">for</span> link <span class="kw">in</span> links <span class="cf">if</span> link.get(<span class="st">'href'</span>).endswith(<span class="st">'xls'</span>)]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># download the xls files and save them in the current directory</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> link <span class="kw">in</span> xls_links:</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    xls_url <span class="op">=</span> link.get(<span class="st">'href'</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    xls_name <span class="op">=</span> xls_url.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    xls <span class="op">=</span> requests.get(xls_url)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(xls_name, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        f.write(xls.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="listing-all-the-saved-xls-files-in-the-current-directory" class="level2">
<h2 class="anchored" data-anchor-id="listing-all-the-saved-xls-files-in-the-current-directory">Listing all the saved xls files in the current directory:</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter only .xls files</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>xls_files <span class="op">=</span> [<span class="bu">file</span> <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(os.getcwd()) <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">'.xls'</span>)]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>xls_files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>['ST53_2010-12.xls',
 'ST53_2011-12.xls',
 'ST53_2012-12.xls',
 'ST53_2013-12.xls',
 'ST53_2014-12.xls',
 'ST53_2016-12.xls',
 'ST53_2017-12.xls',
 'ST53_2018-12.xls',
 'ST53_2019-12.xls',
 'ST53_2020-12.xls',
 'ST53_2021-12.xls',
 'ST53_Current.xls']</code></pre>
</div>
</div>
</section>
<section id="reading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-the-data">Reading the Data</h2>
<p>The <code>.xls</code> format is supported by Pandas using the <code>xrld</code> engine. Therefore, we import the <strong>xrld</strong> library along pandas and numpy libraries:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xlrd</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get a better understanding of each file, we can read the 2010 data file:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sheets <span class="op">=</span> pd.read_excel(xls_files[<span class="dv">0</span>], sheet_name <span class="op">=</span> <span class="va">None</span>, skiprows <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'sheet names: </span><span class="sc">{</span>sheets<span class="sc">.</span>keys()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sheet names: dict_keys(['BITUMEN', 'WATER', 'STEAM', 'WELLS', 'SOR', 'WSR'])</code></pre>
</div>
</div>
<p>This file has 6 sheets. The first three rows of each sheet are not useful. Therefore, we can skip them using the <code>skiprows</code> argument. The last few rows of each sheet are also not useful. There are some footnote information that can be skipped. The total production/injection/number of wells are also reported at the end of the first 4 sheets (BITUMEN, WATER, STEAM, and WELLS). We can skip them as well since we do the aggregation ourselves. Monthly “Conventional Bitumen Recovery” data are also reported in the BITUMEN sheet. We can skip them as well since we are only interested in the in-situ oilsands data.</p>
<p>The SOR and WSR sheets have a different structure and should be handled separately. We will skip them for now.</p>
<p>The number of rows to skip is not the same for all the sheets. However, there is a shared column called <strong>Recovery Method</strong> in the first 4 sheets (BITUMEN, WATER, STEAM, and WELLS) with an input string value, <strong>Total</strong>, in its last row. The row index of this cell can be used to remove all the rows below it in all 4 sheets. The following code finds the row index of the cell with the value <strong>Total</strong> in the <strong>Recovery Method</strong> column for the Bitumen sheet:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bitumen <span class="op">=</span> sheets[<span class="st">'BITUMEN'</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="op">-</span><span class="dv">15</span>:<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Operator</th>
      <th>Scheme Name</th>
      <th>Area</th>
      <th>Approval Number</th>
      <th>Recovery Method</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>162</th>
      <td>Koch Exploration Canada G/P Ltd. (¹)</td>
      <td>NaN</td>
      <td>Cold Lake</td>
      <td>9908D</td>
      <td>Primary</td>
    </tr>
    <tr>
      <th>163</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Total</td>
    </tr>
    <tr>
      <th>164</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>165</th>
      <td>Conventional Bitumen Recovery</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>166</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>167</th>
      <td>Total</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>168</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>169</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>170</th>
      <td>Notes:</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>171</th>
      <td>- Monthly production totals may be revised due...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>172</th>
      <td>- Total may not add due to rounding</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>173</th>
      <td>- Conventional Bitumen production consists of ...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>174</th>
      <td>- Monthly average does not include months ther...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>175</th>
      <td>¹ Amended this month</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the index of the last row using np.where</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>last_row_idx <span class="op">=</span> np.where(bitumen[[<span class="st">"Recovery Method"</span>]] <span class="op">==</span> <span class="st">"Total "</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>last_row_idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>163</code></pre>
</div>
</div>
<div class="cell" data-tbl-font-size="12pt" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>bitumen <span class="op">=</span> bitumen.iloc[<span class="dv">0</span>:last_row_idx,:]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="op">-</span><span class="dv">4</span>:, <span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Operator</th>
      <th>Scheme Name</th>
      <th>Area</th>
      <th>Approval Number</th>
      <th>Recovery Method</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159</th>
      <td>Frog Lake Energy Resources Corp.</td>
      <td>NaN</td>
      <td>Cold Lake</td>
      <td>9827B</td>
      <td>Primary</td>
    </tr>
    <tr>
      <th>160</th>
      <td>Husky Oil Operations Limited</td>
      <td>NaN</td>
      <td>Cold Lake</td>
      <td>9873</td>
      <td>Primary</td>
    </tr>
    <tr>
      <th>161</th>
      <td>Canadian Natural Resources Limited</td>
      <td>NaN</td>
      <td>Athabasca</td>
      <td>9884D</td>
      <td>Primary</td>
    </tr>
    <tr>
      <th>162</th>
      <td>Koch Exploration Canada G/P Ltd. (¹)</td>
      <td>NaN</td>
      <td>Cold Lake</td>
      <td>9908D</td>
      <td>Primary</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Getting a summary statistics of monthly production data:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>bitumen.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Jan</th>
      <th>Feb</th>
      <th>Mar</th>
      <th>Apr</th>
      <th>May</th>
      <th>Jun</th>
      <th>Jul</th>
      <th>Aug</th>
      <th>Sep</th>
      <th>Oct</th>
      <th>Nov</th>
      <th>Dec</th>
      <th>Monthly Average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>163.000000</td>
      <td>163.000000</td>
      <td>163.000000</td>
      <td>162.000000</td>
      <td>162.000000</td>
      <td>159.000000</td>
      <td>159.000000</td>
      <td>159.000000</td>
      <td>158.000000</td>
      <td>156.000000</td>
      <td>156.000000</td>
      <td>153.000000</td>
      <td>150.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>671.311840</td>
      <td>713.568589</td>
      <td>736.528160</td>
      <td>719.761914</td>
      <td>751.057407</td>
      <td>770.060440</td>
      <td>768.772013</td>
      <td>762.359686</td>
      <td>685.194494</td>
      <td>761.591218</td>
      <td>821.775385</td>
      <td>849.108301</td>
      <td>800.676533</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2488.241673</td>
      <td>2660.740849</td>
      <td>2692.278391</td>
      <td>2584.202061</td>
      <td>2648.569375</td>
      <td>2664.979209</td>
      <td>2652.436071</td>
      <td>2622.690639</td>
      <td>2496.212516</td>
      <td>2628.751620</td>
      <td>2865.385297</td>
      <td>2941.181627</td>
      <td>2724.526904</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.670000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.110000</td>
      <td>3.660000</td>
      <td>3.315000</td>
      <td>2.067500</td>
      <td>2.892500</td>
      <td>6.040000</td>
      <td>6.455000</td>
      <td>6.655000</td>
      <td>8.417500</td>
      <td>9.100000</td>
      <td>8.837500</td>
      <td>11.100000</td>
      <td>11.470000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>39.570000</td>
      <td>43.260000</td>
      <td>51.980000</td>
      <td>50.980000</td>
      <td>55.885000</td>
      <td>58.490000</td>
      <td>50.490000</td>
      <td>54.660000</td>
      <td>55.860000</td>
      <td>61.850000</td>
      <td>60.265000</td>
      <td>65.290000</td>
      <td>69.835000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>254.340000</td>
      <td>270.585000</td>
      <td>254.895000</td>
      <td>261.485000</td>
      <td>264.015000</td>
      <td>273.185000</td>
      <td>271.265000</td>
      <td>287.000000</td>
      <td>282.972500</td>
      <td>265.727500</td>
      <td>275.777500</td>
      <td>358.940000</td>
      <td>315.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>23584.240000</td>
      <td>24413.060000</td>
      <td>23835.730000</td>
      <td>23031.680000</td>
      <td>22084.790000</td>
      <td>22156.210000</td>
      <td>22194.560000</td>
      <td>22850.410000</td>
      <td>21877.320000</td>
      <td>23042.230000</td>
      <td>23599.280000</td>
      <td>23806.840000</td>
      <td>23039.700000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="operators" class="level2">
<h2 class="anchored" data-anchor-id="operators">Operators</h2>
<p>The list of all operators in alphabetical order is obtained using the <code>sorted()</code> method:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>operators <span class="op">=</span> <span class="bu">sorted</span>(bitumen.Operator.unique())</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>operators</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>['Action Energy Inc.',
 'Baytex Energy Ltd.',
 'Baytex Energy Ltd. (¹)',
 'Baytex Energy Ltd. (¹²)',
 'Bellatrix Exploration Ltd. (¹²)',
 'Blackpearl Resources Inc. (¹)',
 'Bonavista Petroleum Ltd.',
 'Bronco Energy Ltd.',
 'Buffalo Resources Corp.',
 'Canadian Natural Resources',
 'Canadian Natural Resources Limited',
 'Canadian Natural Resources Limited (¹)',
 'Canadian Natural Resources Limited (¹²)',
 'Cenovus Energy Inc.',
 'Cenovus Energy Inc. (¹)',
 'Cenovus FCCL Ltd.',
 'Connacher Oil And Gas Limited',
 'ConocoPhillips Canada Limited',
 'ConocoPhillips Canada Resources Corp.',
 'Crispin Energy Inc.',
 'Devon Canada Corporation',
 'Devon NEC Corporation (¹)',
 'ExxonMobil Canada Ltd.',
 'Frog Lake Energy Resources Corp.',
 'Harvest Operations Corp.',
 'Husky Oil Operations Limited',
 'Husky Oil Operations Limited (et Al)',
 'Husky Oil Operations Limited (¹)',
 'Husky Oil Operations Ltd.',
 'Imperial Oil Resources (¹)',
 'Japan Canada Oil Sands Limited (¹)',
 'Koch Exploration Canada G/P Ltd.',
 'Koch Exploration Canada G/P Ltd. (¹)',
 'Manitok Exploration Inc.',
 'Meg Energy Corp.',
 'Murphy Oil Canada',
 'Murphy Oil Company Ltd.',
 'Nexen Inc.',
 'North Peace Energy Corp.',
 'Penn West Energy Trust',
 'Penn West Petroleum Ltd.',
 'Prosper Petroleum Ltd.',
 'Shell Canada Energy',
 'Shell Canada Limited',
 'Solara Exploration Ltd.',
 'Statoil Canada Ltd. (¹)',
 'Suncor Energy Inc.',
 'Suncor Energy Inc. (¹)',
 'Sunshine Oilsands Ltd.',
 'Total E&amp;P Joslyn Ltd. (¹)',
 'Twin Butte Energy Ltd.',
 'Watch Resources Ltd.']</code></pre>
</div>
</div>
<p>Some operators names come with additional information in forms of superscript numbers in paranteses at the end of the name. These numbers and information are not useful for our analysis. Therefore, they should be removed:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>operators <span class="op">=</span> [operator.split(<span class="st">'('</span>)[<span class="dv">0</span>].strip() <span class="cf">for</span> operator <span class="kw">in</span> operators]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>operators</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>['Action Energy Inc.',
 'Baytex Energy Ltd.',
 'Baytex Energy Ltd.',
 'Baytex Energy Ltd.',
 'Bellatrix Exploration Ltd.',
 'Blackpearl Resources Inc.',
 'Bonavista Petroleum Ltd.',
 'Bronco Energy Ltd.',
 'Buffalo Resources Corp.',
 'Canadian Natural Resources',
 'Canadian Natural Resources Limited',
 'Canadian Natural Resources Limited',
 'Canadian Natural Resources Limited',
 'Cenovus Energy Inc.',
 'Cenovus Energy Inc.',
 'Cenovus FCCL Ltd.',
 'Connacher Oil And Gas Limited',
 'ConocoPhillips Canada Limited',
 'ConocoPhillips Canada Resources Corp.',
 'Crispin Energy Inc.',
 'Devon Canada Corporation',
 'Devon NEC Corporation',
 'ExxonMobil Canada Ltd.',
 'Frog Lake Energy Resources Corp.',
 'Harvest Operations Corp.',
 'Husky Oil Operations Limited',
 'Husky Oil Operations Limited',
 'Husky Oil Operations Limited',
 'Husky Oil Operations Ltd.',
 'Imperial Oil Resources',
 'Japan Canada Oil Sands Limited',
 'Koch Exploration Canada G/P Ltd.',
 'Koch Exploration Canada G/P Ltd.',
 'Manitok Exploration Inc.',
 'Meg Energy Corp.',
 'Murphy Oil Canada',
 'Murphy Oil Company Ltd.',
 'Nexen Inc.',
 'North Peace Energy Corp.',
 'Penn West Energy Trust',
 'Penn West Petroleum Ltd.',
 'Prosper Petroleum Ltd.',
 'Shell Canada Energy',
 'Shell Canada Limited',
 'Solara Exploration Ltd.',
 'Statoil Canada Ltd.',
 'Suncor Energy Inc.',
 'Suncor Energy Inc.',
 'Sunshine Oilsands Ltd.',
 'Total E&amp;P Joslyn Ltd.',
 'Twin Butte Energy Ltd.',
 'Watch Resources Ltd.']</code></pre>
</div>
</div>
<p>We use <code>set()</code> to get a unique list of operators:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>operators <span class="op">=</span> <span class="bu">sorted</span>([<span class="op">*</span><span class="bu">set</span>(operators)])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>operators</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>['Action Energy Inc.',
 'Baytex Energy Ltd.',
 'Bellatrix Exploration Ltd.',
 'Blackpearl Resources Inc.',
 'Bonavista Petroleum Ltd.',
 'Bronco Energy Ltd.',
 'Buffalo Resources Corp.',
 'Canadian Natural Resources',
 'Canadian Natural Resources Limited',
 'Cenovus Energy Inc.',
 'Cenovus FCCL Ltd.',
 'Connacher Oil And Gas Limited',
 'ConocoPhillips Canada Limited',
 'ConocoPhillips Canada Resources Corp.',
 'Crispin Energy Inc.',
 'Devon Canada Corporation',
 'Devon NEC Corporation',
 'ExxonMobil Canada Ltd.',
 'Frog Lake Energy Resources Corp.',
 'Harvest Operations Corp.',
 'Husky Oil Operations Limited',
 'Husky Oil Operations Ltd.',
 'Imperial Oil Resources',
 'Japan Canada Oil Sands Limited',
 'Koch Exploration Canada G/P Ltd.',
 'Manitok Exploration Inc.',
 'Meg Energy Corp.',
 'Murphy Oil Canada',
 'Murphy Oil Company Ltd.',
 'Nexen Inc.',
 'North Peace Energy Corp.',
 'Penn West Energy Trust',
 'Penn West Petroleum Ltd.',
 'Prosper Petroleum Ltd.',
 'Shell Canada Energy',
 'Shell Canada Limited',
 'Solara Exploration Ltd.',
 'Statoil Canada Ltd.',
 'Suncor Energy Inc.',
 'Sunshine Oilsands Ltd.',
 'Total E&amp;P Joslyn Ltd.',
 'Twin Butte Energy Ltd.',
 'Watch Resources Ltd.']</code></pre>
</div>
</div>
<p>There are still some operators with similar names in the list. For example, ConocoPhillips Canada Resources Corp.&nbsp;and ConocoPhillips Canada Limited are the same company. In this scenario, we use one unique name for each company. The following dictionary is used to replace the names:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>operators_dict <span class="op">=</span> {<span class="st">'Canadian Natural Resources'</span>: <span class="st">'CNRL'</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Canadian Natural Resources Limited'</span>: <span class="st">'CNRL'</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Cenovus Energy Inc.'</span>: <span class="st">'Cenovus'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Cenovus FCCL Ltd.'</span>: <span class="st">'Cenovus'</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'ConocoPhillips Canada Resources Corp.'</span>: <span class="st">'ConocoPhillips'</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'ConocoPhillips Canada Limited'</span>: <span class="st">'ConocoPhillips'</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Devon Canada Corporation'</span>: <span class="st">'Devon'</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Devon NEC Corporation'</span>: <span class="st">'Devon'</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'ExxonMobil Canada Ltd.'</span>: <span class="st">'Imperial Oil'</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Imperial Oil Resources'</span>: <span class="st">'Imperial Oil'</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Murphy Oil Canada'</span>: <span class="st">'Murphy Oil'</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Murphy Oil Company Ltd.'</span>: <span class="st">'Murphy Oil'</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Penn West Energy Trust'</span>: <span class="st">'Penn West'</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Penn West Petroleum Ltd.'</span>: <span class="st">'Penn West'</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Shell Canada Energy'</span>: <span class="st">'Shell'</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Shell Canada Limited'</span>: <span class="st">'Shell'</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the next section we use the above dictionary to replace the names in the data frame. It is also noted that there has been a number of acquisitions and mergers in the oil and gas industry. For example, Nexen Inc.&nbsp;was acquired by CNOOC in 2013 and Husky Energy Inc.&nbsp;was acquired by Cenovus Energy Inc.&nbsp;in 2019. However, we ignore these changes for the sake of simplicity.</p>
</section>
<section id="applying-all-the-changes-to-the-data-frame-with-chain-operations" class="level2">
<h2 class="anchored" data-anchor-id="applying-all-the-changes-to-the-data-frame-with-chain-operations">Applying all the changes to the data frame with chain operations:</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>bitumen <span class="op">=</span> (bitumen</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>            .dropna(subset <span class="op">=</span> [<span class="st">'Operator'</span>])</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>            .assign(Operator <span class="op">=</span> <span class="kw">lambda</span> x: x.Operator.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="dv">0</span>].<span class="bu">str</span>.strip())</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            .assign(Operator <span class="op">=</span> <span class="kw">lambda</span> x: x.Operator.<span class="bu">str</span>.replace(<span class="st">'  '</span>, <span class="st">' '</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            .replace({<span class="st">'Operator'</span>: operators_dict})</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>bitumen.Operator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0                                  CNRL
1                                  CNRL
2                    Baytex Energy Ltd.
3              North Peace Energy Corp.
4                             Penn West
                     ...               
158                               Devon
159    Frog Lake Energy Resources Corp.
160        Husky Oil Operations Limited
161                                CNRL
162    Koch Exploration Canada G/P Ltd.
Name: Operator, Length: 163, dtype: object</code></pre>
</div>
</div>
<p>Let’s print out the list of unique operators in the data frame:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove duplicates</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>operators <span class="op">=</span> <span class="bu">sorted</span>([<span class="op">*</span><span class="bu">set</span>(bitumen.Operator)])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>operators</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>['Action Energy Inc.',
 'Baytex Energy Ltd.',
 'Bellatrix Exploration Ltd.',
 'Blackpearl Resources Inc.',
 'Bonavista Petroleum Ltd.',
 'Bronco Energy Ltd.',
 'Buffalo Resources Corp.',
 'CNRL',
 'Cenovus',
 'Connacher Oil And Gas Limited',
 'ConocoPhillips',
 'Crispin Energy Inc.',
 'Devon',
 'Frog Lake Energy Resources Corp.',
 'Harvest Operations Corp.',
 'Husky Oil Operations Limited',
 'Husky Oil Operations Ltd.',
 'Imperial Oil',
 'Japan Canada Oil Sands Limited',
 'Koch Exploration Canada G/P Ltd.',
 'Manitok Exploration Inc.',
 'Meg Energy Corp.',
 'Murphy Oil',
 'Nexen Inc.',
 'North Peace Energy Corp.',
 'Penn West',
 'Prosper Petroleum Ltd.',
 'Shell',
 'Solara Exploration Ltd.',
 'Statoil Canada Ltd.',
 'Suncor Energy Inc.',
 'Sunshine Oilsands Ltd.',
 'Total E&amp;P Joslyn Ltd.',
 'Twin Butte Energy Ltd.',
 'Watch Resources Ltd.']</code></pre>
</div>
</div>
</section>
<section id="merging-rows-with-the-same-operator" class="level2">
<h2 class="anchored" data-anchor-id="merging-rows-with-the-same-operator">Merging rows with the same operator</h2>
<p>Let’s take a look at the first few rows of the data frame:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="dv">0</span>:<span class="dv">5</span>, <span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Operator</th>
      <th>Scheme Name</th>
      <th>Area</th>
      <th>Approval Number</th>
      <th>Recovery Method</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CNRL</td>
      <td>NaN</td>
      <td>Cold Lake</td>
      <td>4746P</td>
      <td>Commercial</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CNRL</td>
      <td>NaN</td>
      <td>Cold Lake</td>
      <td>6726I</td>
      <td>Commercial</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Baytex Energy Ltd.</td>
      <td>Cliffdale Pilot</td>
      <td>Peace River Area 2</td>
      <td>11034E</td>
      <td>Commercial-CSS</td>
    </tr>
    <tr>
      <th>3</th>
      <td>North Peace Energy Corp.</td>
      <td>Red Earth</td>
      <td>Peace River Area 2</td>
      <td>11209A</td>
      <td>Commercial-CSS</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Penn West</td>
      <td>Seal</td>
      <td>Peace River Area 2</td>
      <td>11377A</td>
      <td>Commercial-CSS</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Results show the data frame has multiple rows for some operators. These operators are active in different regions of the province. The <code>Area</code> column shows the region of the operator. To get the cumulative production for each operator, we need to merge the rows with the same operator name. Rows with the same operator name are merged into one row using the <code>groupby()</code> method. It groups rows with the same value in the specified column. The <code>sum()</code> method is used to sum the values in the other columns. The <code>reset_index()</code> method is used to reset the index of the data frame.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bitumen <span class="op">=</span> bitumen.groupby(<span class="st">'Operator'</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="dv">0</span>:<span class="dv">5</span>, <span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Operator</th>
      <th>Jan</th>
      <th>Feb</th>
      <th>Mar</th>
      <th>Apr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Action Energy Inc.</td>
      <td>2.75</td>
      <td>3.13</td>
      <td>3.10</td>
      <td>2.40</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Baytex Energy Ltd.</td>
      <td>1329.74</td>
      <td>1328.52</td>
      <td>1521.26</td>
      <td>1265.24</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Bellatrix Exploration Ltd.</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Blackpearl Resources Inc.</td>
      <td>1.34</td>
      <td>3.32</td>
      <td>1.43</td>
      <td>0.69</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bonavista Petroleum Ltd.</td>
      <td>318.60</td>
      <td>296.70</td>
      <td>287.84</td>
      <td>268.92</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We also add the production year to the dataframe as a new column:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bitumen[<span class="st">'Year'</span>] <span class="op">=</span> xls_files[<span class="dv">0</span>].split(<span class="st">'_'</span>)[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">'-'</span>)[<span class="dv">0</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="dv">0</span>:<span class="dv">5</span>, <span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Operator</th>
      <th>Jan</th>
      <th>Feb</th>
      <th>Mar</th>
      <th>Apr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Action Energy Inc.</td>
      <td>2.75</td>
      <td>3.13</td>
      <td>3.10</td>
      <td>2.40</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Baytex Energy Ltd.</td>
      <td>1329.74</td>
      <td>1328.52</td>
      <td>1521.26</td>
      <td>1265.24</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Bellatrix Exploration Ltd.</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Blackpearl Resources Inc.</td>
      <td>1.34</td>
      <td>3.32</td>
      <td>1.43</td>
      <td>0.69</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bonavista Petroleum Ltd.</td>
      <td>318.60</td>
      <td>296.70</td>
      <td>287.84</td>
      <td>268.92</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="choosing-the-top-5-producers-in-2010" class="level2">
<h2 class="anchored" data-anchor-id="choosing-the-top-5-producers-in-2010">Choosing the top 5 producers in 2010</h2>
<p>We first calculate the annual production for each company and then sort the data frame by the total bitumen production in descending order and select the first 5 rows:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bitumen[<span class="st">'Total'</span>] <span class="op">=</span> bitumen.loc[:,<span class="st">"Jan"</span>:<span class="st">"Dec"</span>].<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the 5 largest producers</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>top5 <span class="op">=</span> bitumen.sort_values(by <span class="op">=</span> <span class="st">'Total'</span>, ascending <span class="op">=</span> <span class="va">False</span>).head(<span class="dv">5</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>top5.iloc[:,<span class="op">-</span><span class="dv">5</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Nov</th>
      <th>Dec</th>
      <th>Monthly Average</th>
      <th>Year</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>32006.40</td>
      <td>33009.93</td>
      <td>28316.22</td>
      <td>2010</td>
      <td>338065.64</td>
    </tr>
    <tr>
      <th>17</th>
      <td>23701.99</td>
      <td>23956.75</td>
      <td>23159.13</td>
      <td>2010</td>
      <td>277909.48</td>
    </tr>
    <tr>
      <th>8</th>
      <td>22587.47</td>
      <td>22853.46</td>
      <td>22244.04</td>
      <td>2010</td>
      <td>266928.43</td>
    </tr>
    <tr>
      <th>30</th>
      <td>14212.22</td>
      <td>13935.72</td>
      <td>13522.57</td>
      <td>2010</td>
      <td>162270.74</td>
    </tr>
    <tr>
      <th>12</th>
      <td>9785.62</td>
      <td>9882.21</td>
      <td>9644.97</td>
      <td>2010</td>
      <td>115733.90</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="plotting-monthly-bitumen-production-for-the-5-largest-producers" class="level2">
<h2 class="anchored" data-anchor-id="plotting-monthly-bitumen-production-for-the-5-largest-producers">Plotting monthly bitumen production for the 5 largest producers</h2>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot monthly bitumen production for the 5 largest producers</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data <span class="op">=</span> top5.loc[:,<span class="st">"Jan"</span>:<span class="st">"Dec"</span>].T, dashes <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.legend(top5.Operator)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Monthly Bitumen Production for the 5 Largest Producers in 2010'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Bitumen Production (m3)'</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_copy_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Downloading Alberta Oilsands Production Data using Python"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Farshad Tabasinejad"</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-02-23"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> "2021-02-23"</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> true</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [python, web scraping]</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "Oilsands_monthly_production_2010.png"</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">  output: true</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-bg: true</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-border-left: "#31BAE9"</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: hover</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">    # fontsize: 12pt</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: zenburn</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># Disclaimer</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>This blog post is for educational purposes only. Any commercial use of the information provided in this blog post is prohibited. For more information about the AER copyright and permission to reproduce, please visit <span class="co">[</span><span class="ot">AER Copyright and Disclaimer</span><span class="co">](https://www.aer.ca/copyright-disclaimer)</span>.</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>The author is not responsible for any damage or loss caused by the use of the information provided in this blog post. </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>Alberta Energy Regulator (AER) lists the monthly injection and production data for all in-situ oilsands projects in Alberta on its website <span class="co">[</span><span class="ot">Alberta Energy Regulator</span><span class="co">](https://www.aer.ca/)</span>. The data is available in several spreadsheets and can be downloaded from <span class="co">[</span><span class="ot">ST53: Alberta In Situ Oil Sands Production Summary</span><span class="co">](https://www.aer.ca/providing-information/data-and-reports/statistical-reports/st53)</span>. The annual data are reported in separate files in **`.xls`** format. Each file has 6 different sheets with information about bitumen, water, steam, wells, SOR, and WSR.</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>In the following, It is shown how to download the data using Python. The entire source code can be downloaded by clicking on **`&lt;/&gt;Code`** next to the blog title.</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Downloading the Data</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="in">`requests`</span> and <span class="in">`BeautifulSoup`</span> are used to download the xls files. The following code downloads all the xls files from the AER website and saves them in the current directory:</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a><span class="co"># get the html</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://www.aer.ca/providing-information/data-and-reports/statistical-reports/st53'</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(url)</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> r.text</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a><span class="co"># parse the html</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(data, <span class="st">'html.parser'</span>)</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a><span class="co"># find all the links</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>links <span class="op">=</span> soup.findAll(<span class="st">'a'</span>, href <span class="op">=</span> <span class="va">True</span>) </span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a><span class="co"># filter links for xls files</span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>xls_links <span class="op">=</span> [link <span class="cf">for</span> link <span class="kw">in</span> links <span class="cf">if</span> link.get(<span class="st">'href'</span>).endswith(<span class="st">'xls'</span>)]</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="co"># download the xls files and save them in the current directory</span></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> link <span class="kw">in</span> xls_links:</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>    xls_url <span class="op">=</span> link.get(<span class="st">'href'</span>)</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>    xls_name <span class="op">=</span> xls_url.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>    xls <span class="op">=</span> requests.get(xls_url)</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(xls_name, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>        f.write(xls.content)</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## Listing all the saved xls files in the current directory:</span></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a><span class="co"># filter only .xls files</span></span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>xls_files <span class="op">=</span> [<span class="bu">file</span> <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(os.getcwd()) <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">'.xls'</span>)]</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>xls_files</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reading the Data</span></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>The <span class="in">`.xls`</span> format is supported by Pandas using the <span class="in">`xrld`</span> engine. Therefore, we import the **xrld** library along pandas and numpy libraries:</span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xlrd</span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a>To get a better understanding of each file, we can read the 2010 data file:</span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>sheets <span class="op">=</span> pd.read_excel(xls_files[<span class="dv">0</span>], sheet_name <span class="op">=</span> <span class="va">None</span>, skiprows <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'sheet names: </span><span class="sc">{</span>sheets<span class="sc">.</span>keys()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>This file has 6 sheets. The first three rows of each sheet are not useful. Therefore, we can skip them using the <span class="in">`skiprows`</span> argument. The last few rows of each sheet are also not useful. There are some footnote information that can be skipped. The total production/injection/number of wells are also reported at the end of the first 4 sheets (BITUMEN, WATER, STEAM, and WELLS). We can skip them as well since we do the aggregation ourselves. Monthly "Conventional Bitumen Recovery" data are also reported in the BITUMEN sheet. We can skip them as well since we are only interested in the in-situ oilsands data.</span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a>The SOR and WSR sheets have a different structure and should be handled separately. We will skip them for now.</span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a>The number of rows to skip is not the same for all the sheets. However, there is a shared column called __Recovery Method__ in the first 4 sheets (BITUMEN, WATER, STEAM, and WELLS) with an input string value, __Total__, in its last row. The row index of this cell can be used to remove all the rows below it in all 4 sheets. The following code finds the row index of the cell with the value __Total__ in the __Recovery Method__ column for the Bitumen sheet:</span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>bitumen <span class="op">=</span> sheets[<span class="st">'BITUMEN'</span>]</span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="op">-</span><span class="dv">15</span>:<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a><span class="co"># get the index of the last row using np.where</span></span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>last_row_idx <span class="op">=</span> np.where(bitumen[[<span class="st">"Recovery Method"</span>]] <span class="op">==</span> <span class="st">"Total "</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>last_row_idx</span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-colwidths: false</span></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-font-size: 12pt</span></span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a>bitumen <span class="op">=</span> bitumen.iloc[<span class="dv">0</span>:last_row_idx,:]</span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="op">-</span><span class="dv">4</span>:, <span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a>Getting a summary statistics of monthly production data:</span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>bitumen.describe()</span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Operators</span></span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a>The list of all operators in alphabetical order is obtained using the <span class="in">`sorted()`</span> method:</span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a>operators <span class="op">=</span> <span class="bu">sorted</span>(bitumen.Operator.unique())</span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a>operators</span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>Some operators names come with additional information in forms of superscript numbers in paranteses at the end of the name. These numbers and information are not useful for our analysis. Therefore, they should be removed:</span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a>operators <span class="op">=</span> [operator.split(<span class="st">'('</span>)[<span class="dv">0</span>].strip() <span class="cf">for</span> operator <span class="kw">in</span> operators]</span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a>operators</span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a>We use <span class="in">`set()`</span> to get a unique list of operators:</span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a>operators <span class="op">=</span> <span class="bu">sorted</span>([<span class="op">*</span><span class="bu">set</span>(operators)])</span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a>operators</span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a>There are still some operators with similar names in the list. For example, ConocoPhillips Canada Resources Corp. and ConocoPhillips Canada Limited are the same company. In this scenario, we use one unique name for each company. The following dictionary is used to replace the names:</span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a>operators_dict <span class="op">=</span> {<span class="st">'Canadian Natural Resources'</span>: <span class="st">'CNRL'</span>,</span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Canadian Natural Resources Limited'</span>: <span class="st">'CNRL'</span>,</span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Cenovus Energy Inc.'</span>: <span class="st">'Cenovus'</span>,</span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Cenovus FCCL Ltd.'</span>: <span class="st">'Cenovus'</span>,</span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'ConocoPhillips Canada Resources Corp.'</span>: <span class="st">'ConocoPhillips'</span>,</span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'ConocoPhillips Canada Limited'</span>: <span class="st">'ConocoPhillips'</span>,</span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Devon Canada Corporation'</span>: <span class="st">'Devon'</span>,</span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Devon NEC Corporation'</span>: <span class="st">'Devon'</span>,</span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'ExxonMobil Canada Ltd.'</span>: <span class="st">'Imperial Oil'</span>,</span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Imperial Oil Resources'</span>: <span class="st">'Imperial Oil'</span>,</span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Murphy Oil Canada'</span>: <span class="st">'Murphy Oil'</span>,</span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Murphy Oil Company Ltd.'</span>: <span class="st">'Murphy Oil'</span>,</span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Penn West Energy Trust'</span>: <span class="st">'Penn West'</span>,</span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Penn West Petroleum Ltd.'</span>: <span class="st">'Penn West'</span>,</span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Shell Canada Energy'</span>: <span class="st">'Shell'</span>,</span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Shell Canada Limited'</span>: <span class="st">'Shell'</span></span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb30-193"><a href="#cb30-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a>In the next section we use the above dictionary to replace the names in the data frame. It is also noted that there has been a number of acquisitions and mergers in the oil and gas industry. For example, Nexen Inc. was acquired by CNOOC in 2013 and Husky Energy Inc. was acquired by Cenovus Energy Inc. in 2019. However, we ignore these changes for the sake of simplicity.</span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a><span class="fu">## Applying all the changes to the data frame with chain operations:</span></span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a>bitumen <span class="op">=</span> (bitumen</span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a>            .dropna(subset <span class="op">=</span> [<span class="st">'Operator'</span>])</span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a>            .assign(Operator <span class="op">=</span> <span class="kw">lambda</span> x: x.Operator.<span class="bu">str</span>.split(<span class="st">'('</span>).<span class="bu">str</span>[<span class="dv">0</span>].<span class="bu">str</span>.strip())</span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a>            .assign(Operator <span class="op">=</span> <span class="kw">lambda</span> x: x.Operator.<span class="bu">str</span>.replace(<span class="st">'  '</span>, <span class="st">' '</span>))</span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a>            .replace({<span class="st">'Operator'</span>: operators_dict})</span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a>bitumen.Operator</span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a>Let's print out the list of unique operators in the data frame:</span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-217"><a href="#cb30-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a><span class="co"># remove duplicates</span></span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a>operators <span class="op">=</span> <span class="bu">sorted</span>([<span class="op">*</span><span class="bu">set</span>(bitumen.Operator)])</span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a>operators</span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a><span class="fu">## Merging rows with the same operator</span></span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a>Let's take a look at the first few rows of the data frame:</span>
<span id="cb30-226"><a href="#cb30-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="dv">0</span>:<span class="dv">5</span>, <span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a>Results show the data frame has multiple rows for some operators. These operators are active in different regions of the province. The <span class="in">`Area`</span> column shows the region of the operator. To get the cumulative production for each operator, we need to merge the rows with the same operator name.</span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a>Rows with the same operator name are merged into one row using the <span class="in">`groupby()`</span> method. It groups rows with the same value in the specified column. The <span class="in">`sum()`</span> method is used to sum the values in the other columns. The <span class="in">`reset_index()`</span> method is used to reset the index of the data frame.</span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a>bitumen <span class="op">=</span> bitumen.groupby(<span class="st">'Operator'</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb30-240"><a href="#cb30-240" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="dv">0</span>:<span class="dv">5</span>, <span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb30-241"><a href="#cb30-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a>We also add the production year to the dataframe as a new column:</span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, fontsize = 6}</span></span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a>bitumen[<span class="st">'Year'</span>] <span class="op">=</span> xls_files[<span class="dv">0</span>].split(<span class="st">'_'</span>)[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">'-'</span>)[<span class="dv">0</span>]</span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a>bitumen.iloc[<span class="dv">0</span>:<span class="dv">5</span>, <span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a><span class="fu">## Choosing the top 5 producers in 2010</span></span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a>We first calculate the annual production for each company and then sort the data frame by the total bitumen production in descending order and select the first 5 rows:</span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a>bitumen[<span class="st">'Total'</span>] <span class="op">=</span> bitumen.loc[:,<span class="st">"Jan"</span>:<span class="st">"Dec"</span>].<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a><span class="co"># select the 5 largest producers</span></span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a>top5 <span class="op">=</span> bitumen.sort_values(by <span class="op">=</span> <span class="st">'Total'</span>, ascending <span class="op">=</span> <span class="va">False</span>).head(<span class="dv">5</span>)</span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a>top5.iloc[:,<span class="op">-</span><span class="dv">5</span>:]</span>
<span id="cb30-267"><a href="#cb30-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-268"><a href="#cb30-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-269"><a href="#cb30-269" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting monthly bitumen production for the 5 largest producers</span></span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a><span class="co"># plot monthly bitumen production for the 5 largest producers</span></span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data <span class="op">=</span> top5.loc[:,<span class="st">"Jan"</span>:<span class="st">"Dec"</span>].T, dashes <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb30-285"><a href="#cb30-285" aria-hidden="true" tabindex="-1"></a>plt.legend(top5.Operator)</span>
<span id="cb30-286"><a href="#cb30-286" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Monthly Bitumen Production for the 5 Largest Producers in 2010'</span>)</span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Bitumen Production (m3)'</span>)</span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a> </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>